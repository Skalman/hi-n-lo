/* Version: 2013-03-10 (ea89cd755b)
 *
 * Copyright 2009-2012 Kris Kowal under the terms of the MIT
 * license found at http://github.com/kriskowal/q/raw/master/LICENSE
 *
 * With parts by Tyler Close
 * Copyright 2007-2009 Tyler Close under the terms of the MIT X license found
 * at http://www.opensource.org/licenses/mit-license.html
 * Forked at ref_send.js version: 2009-05-11
 *
 * With parts by Mark Miller
 * Copyright (C) 2011 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */
 (function(n){if("function"==typeof bootstrap)bootstrap("promise",n)
else if("object"==typeof exports)module.exports=n()
else if("function"==typeof define&&define.amd)define(n)
else if("undefined"!=typeof ses){if(!ses.ok())return
ses.makeQ=n}else Q=n()})(function(){"use strict"
function n(n){var e=Function.call
return function(){return e.apply(n,arguments)}}function e(n){return"[object StopIteration]"===ce(n)||n instanceof _}function t(n,e){e.stack&&"object"==typeof n&&null!==n&&n.stack&&-1===n.stack.indexOf(fe)&&(n.stack=r(n.stack)+"\n"+fe+"\n"+r(e.stack))}function r(n){for(var e=n.split("\n"),t=[],r=0;e.length>r;++r){var u=e[r]
i(u)||o(u)||t.push(u)}return t.join("\n")}function o(n){return-1!==n.indexOf("(module.js:")||-1!==n.indexOf("(node.js:")}function i(n){var e=/at .+ \((.*):(\d+):\d+\)/.exec(n)
if(!e)return!1
var t=e[1],r=e[2]
return t===X&&r>=Z&&de>=r}function u(){if(Error.captureStackTrace){var n,e,t=Error.prepareStackTrace
return Error.prepareStackTrace=function(t,r){n=r[1].getFileName(),e=r[1].getLineNumber()},Error().stack,Error.prepareStackTrace=t,X=n,e}}function c(n){return j(n)}function f(){function n(n){t&&(e=j(n),ee(t,function(n,t){Y(function(){e.promiseDispatch.apply(e,t)})},void 0),t=void 0,r=void 0)}var e,t=[],r=[],o=oe(f.prototype),i=oe(a.prototype)
return i.promiseDispatch=function(n,o,i){var u=ne(arguments)
t?(t.push(u),"when"===o&&i[1]&&r.push(i[1])):Y(function(){e.promiseDispatch.apply(e,u)})},i.valueOf=function(){if(t)return i
var n=p(e)
return l(n)&&(e=n),n},Error.captureStackTrace&&c.longStackJumpLimit>0&&(Error.captureStackTrace(i,f),i.stack=i.stack.substring(i.stack.indexOf("\n")+1)),o.promise=i,o.resolve=n,o.fulfill=function(e){n(g(e))},o.reject=function(e){n(k(e))},o.notify=function(n){t&&ee(r,function(e,t){Y(function(){t(n)})},void 0)},o}function s(n){var e=f()
return A(n,e.resolve,e.reject,e.notify).fail(e.reject),e.promise}function a(n,e,t,r,o){void 0===e&&(e=function(n){return k(Error("Promise does not support operation: "+n))})
var i=oe(a.prototype)
return i.promiseDispatch=function(t,r,o){var u
try{u=n[r]?n[r].apply(i,o):e.call(i,r,o)}catch(c){u=k(c)}t&&t(u)},t&&(i.valueOf=t),o&&(i.exception=r),i}function p(n){return l(n)?n.valueOf():n}function l(n){return n&&"function"==typeof n.promiseDispatch}function d(n){return n&&"function"==typeof n.then}function v(n){return!m(n)&&!y(n)}function m(n){return!d(p(n))}function y(n){return n=p(n),l(n)&&"exception"in n}function h(){se||"undefined"==typeof window||window.Touch||!window.console||console.log("Should be empty:",pe),se=!0}function k(n){var e=a({when:function(e){if(e){var t=te(ae,this);-1!==t&&(pe.splice(t,1),ae.splice(t,1))}return e?e(n):this}},function(){return k(n)},function(){return this},n,!0)
return h(),ae.push(e),pe.push(n),e}function g(n){return a({when:function(){return n},get:function(e){return n[e]},set:function(e,t){n[e]=t},"delete":function(e){delete n[e]},post:function(e,t){return null===e||void 0===e?n.apply(void 0,t):n[e].apply(n,t)},apply:function(e,t){return n.apply(e,t)},keys:function(){return ue(n)}},void 0,function(){return n})}function j(n){return l(n)?n:(n=p(n),d(n)?w(n):g(n))}function w(n){var e=f()
return Y(function(){try{n.then(e.resolve,e.reject,e.notify)}catch(t){e.reject(t)}}),e.promise}function b(n){return a({isDef:function(){}},function(e,t){return E(n,e,t)},function(){return p(n)})}function x(n,e,r,o){function i(n){try{return"function"==typeof e?e(n):n}catch(t){return k(t)}}function u(n){if("function"==typeof r){t(n,l)
try{return r(n)}catch(e){return k(e)}}return k(n)}function s(n){return"function"==typeof o?o(n):n}var a=f(),p=!1,l=j(n)
return Y(function(){l.promiseDispatch(function(n){p||(p=!0,a.resolve(i(n)))},"when",[function(n){p||(p=!0,a.resolve(u(n)))}])}),l.promiseDispatch(void 0,"when",[void 0,function(n){var e,t=!1
try{e=s(n)}catch(r){if(t=!0,!c.onerror)throw r
c.onerror(r)}t||a.notify(e)}]),a.promise}function T(n,e,t){return x(n,function(n){return I(n).then(function(n){return e.apply(void 0,n)},t)},t)}function R(n){return function(){function t(n,t){var u
try{u=r[n](t)}catch(c){return e(c)?c.value:k(c)}return x(u,o,i)}var r=n.apply(this,arguments),o=t.bind(t,"send"),i=t.bind(t,"throw")
return o()}}function O(n){throw new _(n)}function S(n){return function(){return T([this,I(arguments)],function(e,t){return n.apply(e,t)})}}function E(n,e,t){var r=f()
return Y(function(){j(n).promiseDispatch(r.resolve,e,t)}),r.promise}function D(n){return function(e){var t=ne(arguments,1)
return E(e,n,t)}}function N(n,e){var t=ne(arguments,2)
return le(n,e,t)}function P(n,e){return E(n,"apply",[void 0,e])}function A(n){var e=ne(arguments,1)
return P(n,e)}function F(n){var e=ne(arguments,1)
return function(){var t=e.concat(ne(arguments))
return E(n,"apply",[this,t])}}function I(n){return x(n,function(n){var e=0,t=f()
return ee(n,function(r,o,i){m(o)?n[i]=p(o):(++e,x(o,function(r){n[i]=r,0===--e&&t.resolve(n)},t.reject))},void 0),0===e&&t.resolve(n),t.promise})}function M(n){return x(n,function(n){return n=re(n,j),x(I(re(n,function(n){return x(n,$,$)})),function(){return n})})}function L(n,e){return x(n,void 0,e)}function C(n,e){return x(n,void 0,void 0,e)}function J(n,e){return x(n,function(n){return x(e(),function(){return n})},function(n){return x(e(),function(){return k(n)})})}function Q(n,e,r,o){var i=function(e){Y(function(){if(t(e,n),!c.onerror)throw e
c.onerror(e)})},u=e||r||o?x(n,e,r,o):n
"object"==typeof process&&process&&process.domain&&(i=process.domain.bind(i)),L(u,i)}function U(n,e){var t=f(),r=setTimeout(function(){t.reject(Error("Timed out after "+e+" ms"))},e)
return x(n,function(n){clearTimeout(r),t.resolve(n)},function(n){clearTimeout(r),t.reject(n)},t.notify),t.promise}function V(n,e){void 0===e&&(e=n,n=void 0)
var t=f()
return x(n,void 0,void 0,t.notify),setTimeout(function(){t.resolve(n)},e),t.promise}function q(n,e){var t=ne(e),r=f()
return t.push(r.makeNodeResolver()),P(n,t).fail(r.reject),r.promise}function z(n){var e=ne(arguments,1),t=f()
return e.push(t.makeNodeResolver()),P(n,e).fail(t.reject),t.promise}function B(n){var e=ne(arguments,1)
return function(){var t=e.concat(ne(arguments)),r=f()
return t.push(r.makeNodeResolver()),P(n,t).fail(r.reject),r.promise}}function G(n,e){var t=ne(arguments,2)
return function(){function r(){return n.apply(e,arguments)}var o=t.concat(ne(arguments)),i=f()
return o.push(i.makeNodeResolver()),P(r,o).fail(i.reject),i.promise}}function H(n,e,t){var r=ne(t||[]),o=f()
return r.push(o.makeNodeResolver()),le(n,e,r).fail(o.reject),o.promise}function K(n,e){var t=ne(arguments,2),r=f()
return t.push(r.makeNodeResolver()),le(n,e,t).fail(r.reject),r.promise}function W(n,e){return e?(n.then(function(n){Y(function(){e(null,n)})},function(n){Y(function(){e(n)})}),void 0):n}var X,Y,Z=u(),$=function(){}
"undefined"!=typeof process?Y=process.nextTick:"function"==typeof setImmediate?Y="undefined"!=typeof window?setImmediate.bind(window):setImmediate:function(){function n(){if(--i,++c>=o){c=0,o*=4
for(var n=u&&Math.min(u-1,o);n>i;)++i,e()}for(;u;){--u,t=t.next
var r=t.task
t.task=void 0,r()}c=0}var e,t={task:void 0,next:null},r=t,o=2,i=0,u=0,c=0
if(Y=function(n){r=r.next={task:n,next:null},++u>i&&o>i&&(++i,e())},"undefined"!=typeof MessageChannel){var f=new MessageChannel
f.port1.onmessage=n,e=function(){f.port2.postMessage(0)}}else e=function(){setTimeout(n,0)}}()
var _,ne=n(Array.prototype.slice),ee=n(Array.prototype.reduce||function(n,e){var t=0,r=this.length
if(1===arguments.length)for(;;){if(t in this){e=this[t++]
break}if(++t>=r)throw new TypeError}for(;r>t;t++)t in this&&(e=n(e,this[t],t))
return e}),te=n(Array.prototype.indexOf||function(n){for(var e=0;this.length>e;e++)if(this[e]===n)return e
return-1}),re=n(Array.prototype.map||function(n,e){var t=this,r=[]
return ee(t,function(o,i,u){r.push(n.call(e,i,u,t))},void 0),r}),oe=Object.create||function(n){function e(){}return e.prototype=n,new e},ie=n(Object.prototype.hasOwnProperty),ue=Object.keys||function(n){var e=[]
for(var t in n)ie(n,t)&&e.push(t)
return e},ce=n(Object.prototype.toString)
_="undefined"!=typeof ReturnValue?ReturnValue:function(n){this.value=n},c.longStackJumpLimit=1
var fe="From previous event:"
c.nextTick=Y,c.defer=f,f.prototype.makeNodeResolver=function(){var n=this
return function(e,t){e?n.reject(e):arguments.length>2?n.resolve(ne(arguments,1)):n.resolve(t)}},c.promise=s,c.makePromise=a,a.prototype.then=function(n,e,t){return x(this,n,e,t)},a.prototype.thenResolve=function(n){return x(this,function(){return n})},a.prototype.thenReject=function(n){return x(this,function(){throw n})},ee(["isFulfilled","isRejected","isPending","dispatch","when","spread","get","put","set","del","delete","post","send","invoke","keys","fapply","fcall","fbind","all","allResolved","timeout","delay","catch","finally","fail","fin","progress","done","nfcall","nfapply","nfbind","denodeify","nbind","ncall","napply","nbind","npost","nsend","ninvoke","nodeify"],function(n,e){a.prototype[e]=function(){return c[e].apply(c,[this].concat(ne(arguments)))}},void 0),a.prototype.toSource=function(){return""+this},a.prototype.toString=function(){return"[object Promise]"},c.nearer=p,c.isPromise=l,c.isPromiseAlike=d,c.isPending=v,c.isFulfilled=m,c.isRejected=y
var se,ae=[],pe=[]
"undefined"!=typeof process&&process.on&&process.on("exit",function(){for(var n=0;pe.length>n;n++){var e=pe[n]
e&&e.stack!==void 0?console.warn("Unhandled rejected promise:",e.stack):console.warn("Unhandled rejected promise (no stack):",e)}}),c.reject=k,c.fulfill=g,c.resolve=j,c.master=b,c.when=x,c.spread=T,c.async=R,c["return"]=O,c.promised=S,c.dispatch=E,c.dispatcher=D,c.get=D("get"),c.set=D("set"),c["delete"]=c.del=D("delete")
var le=c.post=D("post")
c.send=N,c.invoke=N,c.fapply=P,c["try"]=A,c.fcall=A,c.fbind=F,c.keys=D("keys"),c.all=I,c.allResolved=M,c["catch"]=c.fail=L,c.progress=C,c["finally"]=c.fin=J,c.done=Q,c.timeout=U,c.delay=V,c.nfapply=q,c.nfcall=z,c.nfbind=B,c.denodeify=c.nfbind,c.nbind=G,c.npost=H,c.nsend=K,c.ninvoke=c.nsend,c.nodeify=W
var de=u()
return c})